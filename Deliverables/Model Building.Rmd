---
title: "Model Building"
author: "Jeremy Chan"
date: "June 13, 2016"
output: html_document
---

The aim of this document is to catalog the attempts at creating models to predict if passengers on the Titanic survived. The predicton will be based on a training set and then evaluated on a test set for a Kaggle competition.

Loading data
```{r}
if(Sys.info()["sysname"]=="Darwin")
{setwd("~/Documents/GitHub/Kaggle-Titanic/Data")}
# add windows working directory

train = read.csv("train.csv")
test = read.csv("test.csv")
```

Data exploration
```{r}
str(train)
```
891 observations of 12 variables
  PassengerID, survived, passenger class, name, sex, age, num of sibling/spouses aboard, number of parents/children aboard, ticket number, passenger fare, cabin, port of embarkation (C = Cherbourg, Q = Queenstown, S = Southampton)
  
Survival Rates
```{r}
table(train$Survived, dnn = "Survived")
prop.table(table(train$Survived, dnn = "Survived"))
```

It looks like there is a 38.38% survival rate among all passengers. 

Set up test submission 1 and create ouput file 
```{r}
# assume everyone died
test$Survived <- rep(0, 418)
submit = data.frame(PassengerId = test$PassengerId, Survived = test$Survived)
write.csv(submit, file = "theyalldie.csv", row.names = FALSE)
```

Adding more varibles

Exploring gender

Gender Survival Rates
```{r}
table(train$Sex)
prop.table(table(train$Survived, train$Sex), 1)
```

68.13% of females survived and 31.87% of males survived. 

Test submission 2
```{r}
test$Survived = 0 # Zero out survival status
test$Survived[test$Sex == "female"] = 1
submit$Survived = test$Survived
write.csv(submit, file = "females_survive.csv", row.names = FALSE)
```

Model with age
```{r}
train$Child = 0
train$Child[train$Age < 18] = 1
aggregate(Survived ~ Child + Sex, data=train, FUN=function(x) sum(x)/length(x))
```

Creating a manual linear probability model
```{r}
# Using Train
# Replace Age NA values with mean Age
train$Age = ifelse(is.na(train$Age), mean(train$Age, na.rm = TRUE), train$Age) 
# Creates Categorical Variable for Gender
train$Male = ifelse(train$Sex == "male", 1, 0) 
# Creates Categorical Variable for leaving from Cherbourg
train$Embark_C = ifelse(train$Embarked == "C", 1, 0) 
# Creates Categorical Variable for leaving from Queenstown
train$Embark_Q = ifelse(train$Embarked == "Q", 1, 0) 
# Creates Categorical Variable for Child
train$Child = ifelse(train$Age < 18, 1, 0) 

# Creates matrix of manually-selected variables
train_manual = train[, c("Pclass", "Age", "Fare", "Survived", "Male", "Embark_C", "Embark_Q", "Child")]



# head(train_manual)
# Create linear model based on manually-selected variables
simple_linear = lm(Survived~., data = train_manual)
train_manual$Prediction = ifelse(predict(simple_linear, train_manual[-4], type = "response")>= .5, 1, 0)

# Confusion Matrix
table(train_manual$Survived, train_manual$Prediction, dnn = c("Survived", "Predicted"))
# Accuracy Rate
(469+241)/(469+80+101+240)

# Using Test
# Replace Age NA values with mean Age
test$Age = ifelse(is.na(test$Age), mean(train$Age, na.rm = TRUE), test$Age) 
# Replace Fare NA values with mean Fare by class
which(is.na(test$Fare)) # Find NAs
# Calculate means by class
class_means = aggregate(test$Fare, by = list(test$Pclass), function(x) mean(x, na.rm = T))[,2]
# Replace fares if NA
test$Fare = ifelse(test$Pclass == 1, (ifelse(is.na(test$Fare), class_means[1], test$Fare)), test$Fare)
test$Fare = ifelse(test$Pclass == 2, (ifelse(is.na(test$Fare), class_means[2], test$Fare)), test$Fare)
test$Fare = ifelse(test$Pclass == 3, (ifelse(is.na(test$Fare), class_means[3], test$Fare)), test$Fare)
# Creates Categorical Variable for Gender
test$Male = ifelse(test$Sex == "male", 1, 0) 
# Creates Categorical Variable for leaving from Cherbourg
test$Embark_C = ifelse(test$Embarked == "C", 1, 0) 
# Creates Categorical Variable for leaving from Queenstown
test$Embark_Q = ifelse(test$Embarked == "Q", 1, 0) 
# Creates Categorical Variable for Child
test$Child = ifelse(test$Age < 18, 1, 0) 

test$Prediction = ifelse(predict(simple_linear, test, type = "response")>= .5, 1, 0)
# Check for NAs in prediction
which(is.na(test$Prediction))

submit_simple_linear = data.frame(PassengerId = test$PassengerId, Survived = test$Prediction)
write.csv(submit_simple_linear, file = "simple_linear.csv", row.names = FALSE)

# empty.model = glm(Survived~1, data = train_manual, family = binomial(link=logit))

```

This model sees a 74.61% accuracy rate

Automatically fitting a model
```{r}

```